import { PrismaClient } from '@prisma/client'
import bcrypt from 'bcryptjs'

const prisma = new PrismaClient()

async function main() {
  // Create demo organization first
  const organization = await prisma.organization.upsert({
    where: { id: 'demo-org-id' },
    update: {},
    create: {
      id: 'demo-org-id',
      name: 'Peaceful Memorial Services',
      email: 'info@peacefulmemorial.com',
      phone: '(555) 123-4567',
      address: '100 Memorial Avenue',
      city: 'Springfield',
      state: 'IL',
      zipCode: '62701',
      isActive: true
    }
  })

  // Create demo users with organization relationship
  const hashedPassword = await bcrypt.hash('password123', 12)
  
  const adminUser = await prisma.user.upsert({
    where: { email: 'admin@peacefulmemorial.com' },
    update: {},
    create: {
      email: 'admin@peacefulmemorial.com',
      name: 'Sarah Thompson',
      password: hashedPassword,
      role: 'ADMIN',
      organizationId: organization.id
    }
  })

  const managerUser = await prisma.user.upsert({
    where: { email: 'manager@peacefulmemorial.com' },
    update: {},
    create: {
      email: 'manager@peacefulmemorial.com',
      name: 'Michael Davis',
      password: hashedPassword,
      role: 'MANAGER',
      organizationId: organization.id
    }
  })

  const staffUser = await prisma.user.upsert({
    where: { email: 'staff@peacefulmemorial.com' },
    update: {},
    create: {
      email: 'staff@peacefulmemorial.com',
      name: 'Jennifer Wilson',
      password: hashedPassword,
      role: 'USER',
      organizationId: organization.id
    }
  })

  // Create funeral homes
  const existingHome1 = await prisma.funeralHome.findFirst({ 
    where: { 
      name: 'Peaceful Gardens Funeral Home',
      organizationId: organization.id 
    } 
  })
  const funeralHome1 = existingHome1 || await prisma.funeralHome.create({
    data: {
      name: 'Peaceful Gardens Funeral Home',
      address: '123 Memorial Drive',
      city: 'Springfield',
      state: 'IL',
      zipCode: '62701',
      phone: '(217) 555-0123',
      email: 'info@peacefulgardens.com',
      director: 'John Smith',
      capacity: 150,
      organizationId: organization.id
    }
  })

  const existingHome2 = await prisma.funeralHome.findFirst({ 
    where: { 
      name: 'Eternal Rest Chapel',
      organizationId: organization.id 
    } 
  })
  const funeralHome2 = existingHome2 || await prisma.funeralHome.create({
    data: {
      name: 'Eternal Rest Chapel',
      address: '456 Serenity Lane',
      city: 'Springfield',
      state: 'IL',
      zipCode: '62702',
      phone: '(217) 555-0456',
      email: 'contact@eternalrest.com',
      director: 'Sarah Johnson',
      capacity: 200
    }
  })

  // Create florist suppliers
  const existingFlorist1 = await prisma.supplier.findFirst({ where: { name: 'Garden of Memories Florist' } })
  const florist1 = existingFlorist1 || await prisma.supplier.create({
    data: {
      name: 'Garden of Memories Florist',
      email: 'orders@gardenmemories.com',
      phone: '(217) 555-0789',
      address: '789 Flower Street',
      city: 'Springfield',
      state: 'IL',
      zipCode: '62703',
      contactPerson: 'Mary Williams',
      supplierType: 'Florist',
      specialties: 'Funeral arrangements, sympathy flowers, casket sprays',
      notes: '24-hour delivery available'
    }
  })

  const existingFlorist2 = await prisma.supplier.findFirst({ where: { name: 'Heavenly Blooms' } })
  const florist2 = existingFlorist2 || await prisma.supplier.create({
    data: {
      name: 'Heavenly Blooms',
      email: 'info@heavenlyblooms.com',
      phone: '(217) 555-0321',
      address: '321 Rose Avenue',
      city: 'Springfield',
      state: 'IL',
      zipCode: '62704',
      contactPerson: 'Robert Davis',
      supplierType: 'Florist',
      specialties: 'Custom arrangements, wreaths, standing sprays',
      notes: 'Specializes in traditional funeral flowers'
    }
  })

  const existingCaterer = await prisma.supplier.findFirst({ where: { name: 'Comfort Catering' } })
  const caterer = existingCaterer || await prisma.supplier.create({
    data: {
      name: 'Comfort Catering',
      email: 'events@comfortcatering.com',
      phone: '(217) 555-0654',
      address: '654 Service Road',
      city: 'Springfield',
      state: 'IL',
      zipCode: '62705',
      contactPerson: 'Lisa Brown',
      supplierType: 'Caterer',
      specialties: 'Funeral receptions, memorial luncheons',
      notes: 'Compassionate service for grieving families'
    }
  })

  // Create funeral products
  const existingCasketSpray = await prisma.funeralProduct.findFirst({ where: { sku: 'CS-001' } })
  const casketSpray = existingCasketSpray || await prisma.funeralProduct.create({
    data: {
      name: 'Traditional Casket Spray',
      sku: 'CS-001',
      description: 'Elegant white and green casket spray with roses and lilies',
      category: 'Flowers',
      price: 150.00,
      cost: 75.00,
      inventory: 0,
      minStock: 2
    }
  })

  const existingStandingSpray = await prisma.funeralProduct.findFirst({ where: { sku: 'SS-001' } })
  const standingSpray = existingStandingSpray || await prisma.funeralProduct.create({
    data: {
      name: 'Standing Spray - Mixed Colors',
      sku: 'SS-001',
      description: 'Beautiful standing spray with mixed seasonal flowers',
      category: 'Flowers',
      price: 85.00,
      cost: 40.00,
      inventory: 0,
      minStock: 3
    }
  })

  const existingWreath = await prisma.funeralProduct.findFirst({ where: { sku: 'WR-001' } })
  const wreath = existingWreath || await prisma.funeralProduct.create({
    data: {
      name: 'Memorial Wreath',
      sku: 'WR-001',
      description: 'Traditional memorial wreath with white flowers',
      category: 'Flowers',
      price: 65.00,
      cost: 30.00,
      inventory: 0,
      minStock: 5
    }
  })

  const existingSympathyBasket = await prisma.funeralProduct.findFirst({ where: { sku: 'SB-001' } })
  const sympathyBasket = existingSympathyBasket || await prisma.funeralProduct.create({
    data: {
      name: 'Sympathy Flower Basket',
      sku: 'SB-001',
      description: 'Small sympathy basket with mixed flowers',
      category: 'Flowers',
      price: 45.00,
      cost: 20.00,
      inventory: 0,
      minStock: 10
    }
  })

  // Create supplier-product relationships
  const existingSp1 = await prisma.supplierProduct.findFirst({ 
    where: { 
      supplierId: florist1.id,
      productId: casketSpray.id
    }
  })
  if (!existingSp1) {
    await prisma.supplierProduct.create({
      data: {
        supplierId: florist1.id,
        productId: casketSpray.id,
        supplierSku: 'GM-CS-001',
        price: 75.00
      }
    })
  }

  const existingSp2 = await prisma.supplierProduct.findFirst({ 
    where: { 
      supplierId: florist1.id,
      productId: standingSpray.id
    }
  })
  if (!existingSp2) {
    await prisma.supplierProduct.create({
      data: {
        supplierId: florist1.id,
        productId: standingSpray.id,
        supplierSku: 'GM-SS-001',
        price: 40.00
      }
    })
  }

  const existingSp3 = await prisma.supplierProduct.findFirst({ 
    where: { 
      supplierId: florist2.id,
      productId: wreath.id
    }
  })
  if (!existingSp3) {
    await prisma.supplierProduct.create({
      data: {
        supplierId: florist2.id,
        productId: wreath.id,
        supplierSku: 'HB-WR-001',
        price: 30.00
      }
    })
  }

  // Create a sample ceremony
  const existingCeremony = await prisma.ceremony.findFirst({ where: { ceremonyNumber: 'CER-2024-001' } })
  const ceremony = existingCeremony || await prisma.ceremony.create({
    data: {
      ceremonyNumber: 'CER-2024-001',
      funeralHomeId: funeralHome1.id,
      deceasedName: 'John Doe',
      familyContact: 'Jane Doe - (217) 555-9999',
      ceremonyDate: new Date('2024-02-15T14:00:00Z'),
      ceremonyType: 'Funeral Service',
      status: 'PLANNING',
      notes: 'Traditional service with flowers and reception'
    }
  })

  console.log('âœ… Funeral business seed data created successfully!')
  console.log(`ðŸ‘¤ Created ${3} funeral service users`)
  console.log(`ðŸ  Created ${2} funeral homes`)
  console.log(`ðŸŒ¸ Created ${3} suppliers (florists & caterer)`)
  console.log(`ðŸ’ Created ${4} funeral products`)
  console.log(`ðŸ“‹ Created ${1} ceremony`)
  console.log(`\nDemo Login Credentials:`)
  console.log(`- Admin: admin@funeral.com / password123`)
  console.log(`- Manager: manager@funeral.com / password123`)
  console.log(`- Staff: staff@funeral.com / password123`)
}

main()
  .catch((e) => {
    console.error(e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
